<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MindCoach</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; }
      .row { display: flex; gap: 8px; }
      input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
      button { padding: 10px 14px; border-radius: 6px; border: 1px solid #ddd; background:#f5f5f5; }
      .msg { margin: 10px 0; }
      .you { font-weight: 600; }
      .ai { color: #0f766e; }
    </style>
  </head>
  <body>
    <h1>ðŸ’Ž MindCoach</h1>
    <p>Calm, bilingual coaching. Your key stays on the server.</p>

    <div class="row">
      <input id="msg" placeholder="Say hola / hiâ€¦" />
      <button id="send">Send</button>
    </div>

    <div id="log"></div>

    <script>
      const input = document.getElementById("msg");
      const btn = document.getElementById("send");
      const log = document.getElementById("log");

      function add(role, text) {
        const div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<span class="${role==='You'?'you':'ai'}">${role}:</span> ${text}`;
        log.appendChild(div);
        window.scrollTo(0, document.body.scrollHeight);
      }

      async function send() {
        const message = input.value.trim();
        if (!message) return;
        add("You", message);
        input.value = ""; btn.disabled = true; btn.textContent = "Thinkingâ€¦";
        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message, system: "You are MindCoach: calm, bilingual (English/Spanish), brief, supportive." })
          });
          const data = await res.json();
          add("MindCoach", data.text ?? data.error ?? "No response.");
        } catch (e) {
          add("MindCoach", "Network error: " + e.message);
        } finally {
          btn.disabled = false; btn.textContent = "Send";
        }
      }

      btn.onclick = send;
      input.addEventListener("keydown", e => { if (e.key === "Enter") send(); });
    </script>
  </body>
</html>
